@if (showCustomDolar) {
	<div class="input-group mb-3">
		<span class="input-group-text">$</span>
		<input type="number" [min]="0" class="form-control" id="custom" [formControl]="customDolarInput">
		<span class="input-group-text">.00</span>
	</div>
}
<div class="card text-bg-primary">
	<div class="card-header fw-bold d-flex align-items-center border-0">
		<span>Cartas</span>
		<div class="btn-toolbar justify-content-end flex-grow-1" role="toolbar">
			<div class="btn-group card-item-actions me-2" role="group">
				<button type="button" class="btn btn-sm btn-success" (click)="sort('precio', 'asc')">
					<fa-icon [icon]="sortUpIcon" />
				</button>
				<button type="button" class="btn btn-sm btn-success" (click)="sort('precio', 'desc')">
					<fa-icon [icon]="sortDownIcon" />
				</button>
			</div>
			<div class="btn-group">
				<button type="button" class="btn btn-sm btn-success" (click)="toggleDolar()">
					{{ dolarService.userCurrency() }}
				</button>
				<div class="btn-group" ngbDropdown role="group">
					<button type="button" class="btn btn-sm btn-success" ngbDropdownToggle></button>
					<div class="dropdown-menu" ngbDropdownMenu>
						<button ngbDropdownItem (click)="toggleCustomDolar()">
							@if (!showCustomDolar) {
								Fijar dólar custom
							}
							@else {
								Quitar dólar custom
							}
						</button>
					</div>
				</div>
			</div>
			<button type="button" class="btn btn-sm btn-success ms-2" (click)="openExportImg()">
				<fa-icon [icon]="imageIcon" /> Exportar
			</button>

		</div>
	</div>
</div>

<div class="card-body p-0">
	@if (cardList$ | async; as cardList) {
	<div class="row">
		@for(card of cards(); track card) {
			<div
				[class.col-12]="!card.infoReduced"
				[class.col-md-6]="card.infoReduced"
				[class.col-lg-4]="card.infoReduced"
			>
				<div class="card my-3">
					@if(card.infoReduced) {
						<span>
							<button class="border-0 position-absolute top-0 start-100 translate-middle-sm-multiplier badge rounded-close-btn bg-danger" (click)="removeCard(card)">
								<fa-icon [icon]="closeIcon"/>
								<span class="visually-hidden">cantidad cartas</span>
							</button>
							<div class="btn-group-vertical position-absolute top-50 start-100 translate-middle-sm-multiplier-buttons" role="group">
								<button type="button" class="btn btn-sm btn-dark" (click)="changeMultiplier(card, 1)">
									<fa-icon [icon]="plusIcon"/>
								</button>
								<button type="button" class="btn btn-sm btn-dark px-0 active">
									{{ card.multiplier }}
								</button>
								<button type="button" class="btn btn-sm btn-dark" (click)="changeMultiplier(card, -1)">
									<fa-icon [icon]="minusIcon"/>
								</button>
							</div>
							<button class="border-0 position-absolute top-100 start-100 translate-middle-sm-multiplier badge bg-warning" (click)="toggleInfoReduced(card)">
								<fa-icon [icon]="maximizeIcon"/>
								<span class="visually-hidden">maximizar</span>
							</button>

						</span>
					}
					<div class="card-body p-3">
						<app-card-info [data]="card"></app-card-info>
					</div>
				</div>
			</div>
		}
	</div>
	}
	@if(noData) {
		<div class="d-flex flex-column no-cards text-center text-muted justify-content-center px-4">
			<p class="card-text">No agregaste ninguna carta.</p>
			<p class="card-text">¡Agregá cartas usando el buscador!</p>
		</div>
	}
</div>

<div class="card text-bg-dark mb-3">
	<div class="card-footer">
		<p class="card-text fw-bold text-end">
			TOTAL =<span class="ms-1">{{ total() | currency }}</span>
		</p>
	</div>
</div>

@defer {
	<div class="d-grid gap-3 d-sm-flex justify-content-md-center">
		@if (isLoggedIn() && !enableCreateMode && !readonly && !id && !noData) {
			<button class="btn btn-success" type="button" (click)="enableCreateMode = !enableCreateMode">
				<fa-icon [icon]="plusIcon"></fa-icon> Crear lista
			</button>
		}
		@if(!noData) {
			<button class="btn btn-danger" type="button" (click)="openConfirmClear()">
				<fa-icon [icon]="trashIcon"></fa-icon> Limpiar lista
			</button>
		}
	</div>
	@if(enableCreateMode) {
	<div class="card mb-3">
		<div class="card-header text-bg-primary">
			Detalle
		</div>
		<div class="card-body">
			<form class="row g-3 mb-3" [formGroup]="form">
				<div class="col-md-6">
					<label for="name" class="form-label">Nombre</label>
					<input type="text" class="form-control" id="name" formControlName="name" placeholder="Escriba el nombre de la lista">
				</div>
				<!-- <div class="col-md-6">
					<label for="customDolar" class="form-label">Fijar dolar</label>
					<input type="number" class="form-control" id="customDolar" min="0">
				</div> -->
				<div class="col-12">
					<label for="description" class="form-label">Descripción</label>
					<input type="textarea" class="form-control" id="description" formControlName="description" placeholder="Describa brevemente su lista">
				</div>
			</form>
			@if (editMode) {
				<div class="d-grid gap-3 d-sm-flex justify-content-sm-end">
					<button class="btn btn-primary" type="button" (click)="save()">
						<fa-icon [icon]="saveIcon"></fa-icon> Guardar
					</button>
					<button class="btn btn-secondary" type="button" (click)="enableCreateMode = !enableCreateMode">
						<fa-icon [icon]="closeIcon"></fa-icon> Cancelar
					</button>
				</div>	
			}
		</div>
	</div>
	}
}